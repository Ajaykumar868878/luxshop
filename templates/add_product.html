{% extends 'admindash.html' %}

{% block title %}Admin - Add Product{% endblock %}

{% block content %}
<div class="header">
    <h1>Add New Product</h1>
</div>

<div class="recent-orders">
    <h2>Product Details</h2>
    <form id="add-product-form">
        <div class="mb-3">
            <label for="name" class="form-label">Product Name</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="price" class="form-label">Price</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" required>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <label for="stock_quantity" class="form-label">Stock Quantity</label>
                <input type="number" class="form-control" id="stock_quantity" name="stock_quantity" min="0" required>
            </div>
        </div>
        <div class="mb-3">
            <label for="image_url" class="form-label">Image URL</label>
            <input type="url" class="form-control" id="image_url" name="image_url" required>
        </div>
        <div class="mb-3">
            <label for="category" class="form-label">Category</label>
            <input type="text" class="form-control" id="category" name="category" required>
        </div>
        <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Product</button>
        <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">Cancel</a>
    </form>
</div>

<script>
document.getElementById('add-product-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    // Seller ID is required by the database schema, let's use a placeholder for admin-added products
    // In a real scenario, you might have a specific admin or system user ID.
    data.seller_id = 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11'; // A placeholder UUID. 

    try {
        const response = await fetch('/api/admin/products', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        });

        const result = await response.json();

        if (result.success) {
            // You can use flash messages here if you implement them on the frontend
            window.location.href = '{{ url_for("admin_products") }}';
        } else {
            alert('Error adding product: ' + (result.errors || ['Unknown error']).join('\n'));
        }
    } catch (error) {
        console.error('Failed to submit form:', error);
        alert('An unexpected error occurred. Please try again.');
    }
});
</script>
{% endblock %}
